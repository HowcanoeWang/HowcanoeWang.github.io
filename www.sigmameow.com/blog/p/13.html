<p>本文基于《Python科学计算三维可视化》MOOC课程第一周内容结合个人理解所整理的笔记</p>
<blockquote class="blockquote">
<p>https://www.icourse163.org/course/BIT-1001871001</p>
</blockquote>
<p>主要内容有：</p>
<div class="toc">
<ul>
<li><a href="#1">1 背景知识</a><ul>
<li><a href="#11">1.1 三维可视化的主要方法</a></li>
<li><a href="#12">1.2 环境搭建</a><ul>
<li><a href="#121">1.2.1 基础库的下载与安装</a></li>
<li><a href="#122-tvtk">1.2.2 TVTK库安装测试</a></li>
<li><a href="#123-tvtk">1.2.3 TVTK帮助资源</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2-tvtk">2 TVTK基础</a><ul>
<li><a href="#21-data-flow-systempipeline">2.1 数据流系统(Data Flow System):管线(Pipeline)</a><ul>
<li><a href="#211">2.1.1 看歌剧小故事</a></li>
<li><a href="#212">2.1.2 故事分析</a></li>
<li><a href="#213">2.1.3 编程流程</a></li>
<li><a href="#215-ivtk">2.1.5 用ivtk工具观察管线</a><ul>
<li><a href="#openglcamera">照相机属性(OpenGLCamera)</a></li>
<li><a href="#actor">Actor属性</a></li>
<li><a href="#_1">场景属性</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#22">2.2 数据集(剧本格式)</a><ul>
<li><a href="#221-imagedata">2.2.1 ImageData</a></li>
<li><a href="#222-rectlineargrid">2.2.2 RectlinearGrid</a></li>
<li><a href="#223-structuregrid">2.2.3 StructureGrid</a></li>
<li><a href="#224-polydata">2.2.4 PolyData</a></li>
</ul>
</li>
<li><a href="#23">2.3 数据加载(获取改编权的过程)</a><ul>
<li><a href="#231-stl">2.3.1 读取STL文件</a></li>
<li><a href="#232-plot3dnasa">2.3.2 Plot3D(NASA)</a></li>
</ul>
</li>
<li><a href="#24">2.4 数据可视化</a><ul>
<li><a href="#241">2.4.1 标量可视化</a></li>
<li><a href="#242">2.4.2 矢量可视化</a></li>
<li><a href="#243">2.4.3 空间轮廓线可视化</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<hr />
<h1 class="section-heading text-center" id="1">1 背景知识</h1>
<h1 class="section-heading h3" id="11">1.1 三维可视化的主要方法</h3>
<div class="table-responsive"><table class="table table-striped table-bordered" align="center"><tbody><tr><td colspan="3" rowspan="1">1.二维标量数据场</td><td colspan="2" rowspan="1">2.三维标量数据场<br/></td><td colspan="2" rowspan="1">3.矢量数据场<br/></td></tr><tr><td>颜色映射方法<br/></td><td>等值线法<br/></td><td>立体图法&amp;层次分割法<br/></td><td>面绘制法<br/></td><td>体绘制法<br/></td><td>直接法<br/></td><td>流线法<br/></td></tr><tr><td><img class="img-fluid" src="img/13/0.28797075946292616.png"/><br/></td><td><img class="img-fluid" src="img/13/0.4341302545898902.png"/><br/></td><td><img class="img-fluid" src="img/13/789705140.png"/><br/></td><td><img class="img-fluid" src="img/13/453459421.png"/><br/></td><td><img class="img-fluid" src="img/13/453478453.png"/><br/></td><td><div><img class="img-fluid" src="img/13/453601953.png"/></div></td><td><div><img class="img-fluid" src="img/13/453628281.png"/></div></td></tr></tbody></table></div>

<h1 class="section-heading h3" id="12">1.2 环境搭建</h3>
<p>Python3.6(64位)+Pycharm Community安装过程略</p>
<h1 class="section-heading h5" id="121">1.2.1 基础库的下载与安装</h5>
<p>https://www.lfd.uci.edu/~gohlke/pythonlibs，记得找对应的Python版本(3.6)和对应的系统位数(32位没有<code>_amd64.whl</code>)</p>
<ul>
<li>
<p><a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#numpy" target="_blank">numpy‑1.15.4+mkl‑cp36‑cp36m‑win_amd64.whl</a></p>
</li>
<li>
<p><a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#pyqt4" target="_blank">PyQt4‑4.11.4‑cp36‑cp36m‑win_amd64.whl</a></p>
</li>
<li>
<p><a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#vtk" target="_blank">VTK‑8.1.2‑cp36‑cp36m‑win_amd64.whl</a></p>
</li>
<li>
<p><a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#mayavi" target="_blank">mayavi‑4.6.2+vtk81‑cp36‑cp36m‑win_amd64.whl</a></p>
</li>
<li>
<p><a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#traits" target="_blank">traits‑4.6.0‑cp36‑cp36m‑win_amd64.whl</a></p>
</li>
</ul>
<p>建议先建立虚拟环境(我建立一个一个py3d的虚拟环境)，创建虚拟环境的基础操作可以百度或者参考<a href="https://www.sigmameow.com/blog/page.html?id=3#Python%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83">这篇文章</a></p>
<p>使用cmd进入虚拟环境之后，请按照上面的顺序进行安装(后面的包依赖前面的包)</p>
<div class="codehilite"><pre><span></span>(py3d) D:\...\Python\py3d&gt;pip install 下载地址\xxx.whl
</pre></div>


<h1 class="section-heading h5" id="122-tvtk">1.2.2 TVTK库安装测试</h5>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="kn">import</span> <span class="n">tvtk</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">CubeSource</span><span class="p">(</span><span class="n">x_length</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">y_length</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">z_length</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>    <span class="c1"># 创建三维长方体对象</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">vtkCubeSource</span> <span class="p">(</span><span class="mo">00000240</span><span class="n">C5BCC350</span><span class="p">)</span>
  <span class="n">Debug</span><span class="p">:</span> <span class="n">Off</span>
  <span class="n">Modified</span> <span class="n">Time</span><span class="p">:</span> <span class="mi">99</span>
  <span class="n">Reference</span> <span class="n">Count</span><span class="p">:</span> <span class="mi">2</span>
  <span class="o">...</span>
  <span class="n">Progress</span> <span class="n">Text</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">)</span>
  <span class="n">X</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">1</span>
  <span class="n">Y</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">2</span>
  <span class="n">Z</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">3</span>
  <span class="n">Center</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="n">Output</span> <span class="n">Points</span> <span class="n">Precision</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>


<h1 class="section-heading h5" id="123-tvtk">1.2.3 TVTK帮助资源</h5>
<p>http://www.vtk.org/doc/nightly/html/annotated.html
看的过程中注意，上面的文档是VTK的文档，在转成python库的过程中，变量名进行了以下的变更：</p>
<ul>
<li>
<p>TVTK库中的类名去除了前缀vtk</p>
</li>
<li>
<p>函数名按照Python的惯例，采用下划线连接单词
    &gt; AddItem -&gt; add_item</p>
</li>
<li>
<p>VTK对象的方法在TVTK中用Trait属性替代
    如在VTK中<code>m.SetInputConnection(c.GetOutputPort())</code>变成了<code>m.input_connection(c.output_port)</code></p>
</li>
</ul>
<hr />
<h1 class="section-heading text-center" id="2-tvtk">2 TVTK基础</h1>
<h1 class="section-heading h3" id="21-data-flow-systempipeline">2.1 数据流系统(Data Flow System):管线(Pipeline)</h3>
<p><img class="img-fluid" src="img/13/463578140.png"/>
<img class="img-fluid" src="img/13/466222343.png"/></p>
<h1 class="section-heading h5" id="211">2.1.1 看歌剧小故事</h5>
<p>有一天，家里有个矿的小虎想去看自己最喜欢的《四体》歌剧，但是都没有一个剧团排练了这个小说，于是地主家的傻儿子立马决定从零开始组建一个剧团完成自己想要的《四体》歌剧。在咨询了诸多业界砖家后，大体确定了组建流程：联系《四体》的作者小四获得了作品改编权，找知名导演夏岛把小说改成了舞台剧本，包括台词、背景和人物装扮等，找道具师设计道具和衣服。然后去把从艺校里请来的演员按照人物装扮换衣服、化妆、背台词，最后把演员送上舞台，灯光师负责打光，小虎就躺在自己的豪华软床，用对讲机联系摄像师去移动和镜头拉近拉远，"哎对对对，镜头再低点，再低点，再低点，卧槽，为啥自带圣光，摄像师你的鸡腿没了！"</p>
<h1 class="section-heading h5" id="212">2.1.2 故事分析</h5>
<p>上面的例子，模拟了VTK三维可视化过程中从数据到图像的数据流。如图中所示，管线分为了可视化管线和图形管线，可视化管线是将原视数据<strong>[小说]</strong>加工成图形数据<strong>[剧本]</strong>的过程， 而图形管线是将图形数据加工<strong>[剧本]</strong>为我们<strong>[小虎]</strong>所看到的图像过程。</p>
<p>图中主要涉及到5个部分：</p>
<ul>
<li>
<p>Source：一个连接外部数据的接口，可以获取外部的数据；<em>在上面的例子中是联系《四体》作者取得改编权的这条路径</em>。</p>
</li>
<li>
<p>Filter：转换输入的数据，即通过一些图像算法，把数据变为优化的内部数据结构，称之为<strong>数据预处理</strong>；<em>例子中是改编成剧本的这个过程</em>。</p>
</li>
<li>
<p>Mapper： 把数据转换为原始图像，称之为<strong>数据映射</strong>，<em>例子中是指道具师设计衣服等道具</em>。</p>
</li>
<li>
<p>Actor：表示可视数据或对象，即<em>例子中穿上衣服化好妆的演员，具有站位、衣服颜色、面朝方向、身高等属性</em>。
    </p>
</li>
<li>对象的属性(颜色，阴影种类等)
    </li>
<li>几何形状
    </li>
<li>
<p>转换</p>
</li>
<li>
<p>Rendener：<em>例子中的舞台，提供场景(Scene)来供演员表演，以及打光师(光源vtkLights)和摄像师(视角vtkCamera)</em>。</p>
</li>
</ul>
<p>实际操作中，往往还要用到另外两个东西，一个是RenderWindow，即小虎躺在床上从屏幕里看到的摄像机传回的画面，另一个是RenderWindowInteractor，提供了与用户进行交互的功能，如旋转，缩放等，即小虎操控摄影师走位的对讲机。
<img class="img-fluid" src="img/13/196fc472-c042-4e72-bc9a-1dea8ac78038.jpg"/></p>
<h1 class="section-heading h5" id="213">2.1.3 编程流程</h5>
<p>这个简单的例子中，一一对应，用到了下面的几个对象
<div class="table-responsive"><table class="table table-striped table-bordered" align="center"><tbody><tr><td><br/></td><td>TVTK对象</td><td>说明</td><td>例子</td></tr><tr><td colspan="1" rowspan="2">可视化管线</td><td>CubeSource</td><td>通过程序内部计算输出一组描述长方体的数据(PolyData)</td><td>有改编权的小说</td></tr><tr><td>PolyDataMapper</td><td>PolyData通过该映射器将数据映射为图像数据(mapper)</td><td>演员衣服道具</td></tr><tr><td colspan="1" rowspan="4">图形管线</td><td>Actor</td><td>场景中的一个实体，包括一个图形数据(mapper)，具有描述该实体的位置、方向、大小的属性<br/></td><td>穿上衣服拿上道具的演员</td></tr><tr><td>Renderer</td><td>渲染的场景， 包括多个需要渲染的Actor</td><td>舞台，包含灯光师和摄像师</td></tr><tr><td>RenderWindow</td><td>渲染用的图形窗口，包括一个或多个Render</td><td>摄像机传出的屏幕</td></tr><tr><td>RenderWindowInteractor</td><td>给图形窗口提供一些用户交互功能，如平移、旋转、放大缩小。这些操作并不改变Actor或者图像数据的属性，只是调整场景中的照相机或</td><td>小虎操控摄像师的对讲机</td></tr></tbody></table></div></p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="kn">import</span> <span class="n">tvtk</span>

<span class="c1">## 可视化管线 ##</span>
<span class="c1"># 创建一个长方体数据源，并同时设置其长宽高</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">CubeSource</span><span class="p">(</span><span class="n">x_length</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">y_length</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">z_length</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
<span class="c1"># 使用PolyDataMapper将数据转换为图形数据</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">PolyDataMapper</span><span class="p">(</span><span class="n">input_connection</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">output_port</span><span class="p">)</span>

<span class="c1">## 图形管线 ##</span>
<span class="c1"># 创建一个Actor</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">Actor</span><span class="p">(</span><span class="n">mapper</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
<span class="c1"># 创建一个Renderer，将Actor添加进去</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">Renderer</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">r</span><span class="o">.</span><span class="n">add_actor</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="c1"># 创建一个RenderWinder(窗口)， 将Renderer添加进去</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">RenderWindow</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>
<span class="n">w</span><span class="o">.</span><span class="n">add_renderer</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="c1"># 创建一个窗口交互工具RenderWindowInteractor</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">RenderWindowInteractor</span><span class="p">(</span><span class="n">render_window</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
<span class="c1"># 开启交互</span>
<span class="n">i</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>


<h1 class="section-heading h5" id="215-ivtk">2.1.5 用ivtk工具观察管线</h5>
<p>mayavi包里面自带了一个小界面来查看三维模型
<a href="https://www.sigmameow.com/blog/files/13/view_pipeline.py" download="view_pipeline.py">view_pipeline.py</a>:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="kn">import</span> <span class="n">tvtk</span>
<span class="c1"># 导入ivtk界面包</span>
<span class="kn">from</span> <span class="nn">tvtk.tools</span> <span class="kn">import</span> <span class="n">ivtk</span>
<span class="kn">from</span> <span class="nn">pyface.api</span> <span class="kn">import</span> <span class="n">GUI</span>

<span class="c1"># 创建三维模型</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">CubeSource</span><span class="p">(</span><span class="n">x_length</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">y_length</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">z_length</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">PolyDataMapper</span><span class="p">(</span><span class="n">input_connection</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">output_port</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">Actor</span><span class="p">(</span><span class="n">mapper</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># 创建一个带Crust(Python Shell)的窗口</span>
<span class="n">gui</span> <span class="o">=</span> <span class="n">GUI</span><span class="p">()</span>
<span class="n">win</span> <span class="o">=</span> <span class="n">ivtk</span><span class="o">.</span><span class="n">IVTKWithCrustAndBrowser</span><span class="p">()</span>
<span class="n">win</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
<span class="n">win</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_actor</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="c1"># 开启界面消息循环</span>
<span class="n">gui</span><span class="o">.</span><span class="n">start_event_loop</span><span class="p">()</span>
</pre></div>


<p>运行之后，会弹出一个这样的菜单
<img class="img-fluid" alt="tim 20181108085454" src="img/13/0.4816472319245173.png"/></p>
<blockquote class="blockquote">
<p>如果使用mayavi‑4.6.2这个版本，有很大的可能会出现这个<a href="https://github.com/enthought/mayavi/issues/734" target="_blank">issue</a>里面的报错，即AttributeError: 'PipelineBrowser' object has no attribute 'ui'与Pipeline Browser弹出的bug. 
<img class="img-fluid" alt="tim 20181108084520" src="img/13/0.9640163157990207.png"/>
该问题已经在最新版中修复了，如果安装的版本没有修复的话，可以下载<a href="https://www.sigmameow.com/blog/files/13/browser.py" download="browser.py">browser.py</a>和<a href="https://www.sigmameow.com/blog/files/13/ivtk.py" download="ivtk.py">ivtk.py</a>这两个文件，分别替换虚拟环境中py3d\Lib\site-packages\tvtk\tools\ivtk.py和py3d\Lib\site-packages\tvtk\pipeline\browser.py文件即可。</p>
</blockquote>
<p>为了方便之后的学习能快速的调用，我们把上面的代码进行一定的修改，分解成<a href="https://www.sigmameow.com/blog/files/13/tvtkfunc.py" download="tvtkfunc.py">tvtkfunc.py</a>和<a href="https://www.sigmameow.com/blog/files/13/cube_ivtk.py" download="cube_ivtk.py">cube_ivtk.py</a>两个文件
<img class="img-fluid" src="img/13/515789421.png"/>
该工具箱其中的主要功能区为
<img class="img-fluid" src="img/13/035d2b28d5a7899c5384f6f13c7f05d9.png"/>
我们观察管线主要看管线浏览器
<img class="img-fluid" src="img/13/517596125.png"/></p>
<h1 class="section-heading h6 text-muted" id="openglcamera">照相机属性(OpenGLCamera)</h6>
<p>点击，会出来一个属性面板
<img class="img-fluid" src="img/13/523543062.png"/>
其中比较重要的有(稍作了解)：
<div class="table-responsive"><table class="table table-striped table-bordered" align="center"><tbody><tr><td>属性</td><td>说明</td></tr><tr><td>clipping_range</td><td>有两个元素，分别表示照相机到近、远两个裁剪平面的距离。在这两个距离之外将不会显示</td></tr><tr><td>position</td><td>照相机在三维空间中的坐标</td></tr><tr><td>focal_point</td><td>照相机所聚焦的焦点坐标</td></tr><tr><td>view_up</td><td>照相机的上方向矢量</td></tr></tbody></table></div></p>
<h1 class="section-heading h6 text-muted" id="actor">Actor属性</h6>
<p><img class="img-fluid" src="img/13/523765750.png"/></p>
<h1 class="section-heading h6 text-muted" id="_1">场景属性</h6>
<p>点击<strong>场景工具条</strong>最后一个齿轮图标出来这个面板
<img class="img-fluid" src="img/13/3e00868a-ab7e-4b07-8fc1-5971efa9c7d3.png"/>
<img class="img-fluid" src="img/13/632a3491-51cc-49ec-9ba4-23e3a94c2adf.png"/>
可以提供打光师的光颜色角度，舞台背景等设置</p>
<h1 class="section-heading h3" id="22">2.2 数据集(剧本格式)</h3>
<p><img class="img-fluid" src="img/13/528160921.png"/>
数据集(dataset)由点(point)和数据(data)组成</p>
<ul>
<li>
<p>点之间可以是连接或者非连接，连接包括显示(explicit)和隐式(implecit)</p>
</li>
<li>
<p>数据可以是标量(scalar)或者矢量(vector)</p>
</li>
<li>
<p>多个相关的点构成了单元(cell)</p>
</li>
</ul>
<p>TVTK中主要有5种数据集：
<div class="table-responsive"><table class="table table-striped table-bordered" align="center"><tbody><tr><td><br/></td><td>描述</td><td>连结性</td><td>适用于</td></tr><tr><td>ImageData</td><td>点位于正交等距的网格上</td><td>隐式</td><td>体积和面</td></tr><tr><td>RectilinearGrid</td><td>间距不均匀的网格，所有点都在正交的网格上</td><td>隐式</td><td>体积和面</td></tr><tr><td>StructuredGrid</td><td>创建任意形状的网格，需要指定点的坐标</td><td>隐式</td><td>体积和面</td></tr><tr><td>UnstructruedGrid</td><td><br/></td><td>显示</td><td>体积和面</td></tr><tr><td>PolyData<br/></td><td>由一系列点、点之间的联系以及由点构成的多边形组成<br/></td><td>显示</td><td>点线面</td></tr></tbody></table></div></p>
<h1 class="section-heading h5" id="221-imagedata">2.2.1 ImageData</h5>
<p>点位于正交等距的网格上
<img class="img-fluid" src="img/13/529432937.png"/>
<div class="table-responsive"><table class="table table-striped table-bordered" align="center"><tbody><tr><td>参数</td><td>说明</td></tr><tr><td>origin</td><td>三维网格数据的起点坐标</td></tr><tr><td>spacing</td><td>三维网格数据在X，Y，Z轴上的间距</td></tr><tr><td>dimensions</td><td>X，Y，Z轴上的网格数</td></tr></tbody></table></div></p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="kn">import</span> <span class="n">tvtk</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">img</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">ImageData</span><span class="p">(</span><span class="n">spacing</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dimensions</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">img</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="c1"># 获取第一个点</span>
<span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
</pre></div>


<h1 class="section-heading h5" id="222-rectlineargrid">2.2.2 RectlinearGrid</h5>
<p>间距不均匀的网格，所有点都在正交的网格上
<img class="img-fluid" src="img/13/529448531.png"/></p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="kn">import</span> <span class="n">tvtk</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span> <span class="p">,</span><span class="mi">15</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">[)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">RectilinearGrid</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">x_coordinates</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">r</span><span class="o">.</span><span class="n">y_coordinates</span> <span class="o">=</span> <span class="n">y</span>
<span class="n">r</span><span class="o">.</span><span class="n">z_coordinates</span> <span class="o">=</span> <span class="n">z</span>
<span class="n">r</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>


<h1 class="section-heading h5" id="223-structuregrid">2.2.3 StructureGrid</h5>
<p>创建任意形状的网格，需要指定点的坐标
<img class="img-fluid" src="img/13/529467296.png"/>
需要points、dimensions、point_data.scalars等属性进行初始化</p>
<h1 class="section-heading h5" id="224-polydata">2.2.4 PolyData</h5>
<p>由一系列点、点之间的联系以及由点构成的多边形组成
<img class="img-fluid" src="img/13/529534859.png"/>
例如我们创建的长方体，tvtk.CubeSource()就是这种
<div class="table-responsive"><table class="table table-striped table-bordered" align="center"><tbody><tr><td>属性</td><td>说明</td></tr><tr><td>x_length</td><td>长方体对象x轴的长度</td></tr><tr><td>y_length</td><td>长方体对象y轴的长度<br/></td></tr><tr><td>z_length</td><td>长方体对象z轴的长度<br/></td></tr><tr><td>center</td><td>长方体对象所在坐标系的原点</td></tr><tr><td>output_points_precision</td><td>长方体对象的精度</td></tr></tbody></table></div>
一些基本的三维对象
<div class="table-responsive"><table class="table table-striped table-bordered" align="center"><tbody><tr><td>三维对象</td><td>说明</td></tr><tr><td>CubeSource</td><td>立方体三维对象数据源</td></tr><tr><td>ConeSource<br/></td><td>圆锥三维对象数据源</td></tr><tr><td>CylinderSource</td><td>圆柱三维对象数据源</td></tr><tr><td>ArcSource</td><td>圆弧三维对象数据源</td></tr><tr><td>ArrowSource</td><td>箭头三维对象数据源</td></tr></tbody></table></div>
例如创建一个圆锥数据源</p>
<div class="codehilite"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">ConeSource</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">resolution36</span><span class="p">)</span> 
<span class="c1">#设定圆锥的高度，底面半径，分辨率</span>
</pre></div>


<h1 class="section-heading h3" id="23">2.3 数据加载(获取改编权的过程)</h3>
<p>直接读取别的软件建立好的三维模型</p>
<h1 class="section-heading h5" id="231-stl">2.3.1 读取STL文件</h5>
<p>可以从这里下载<a href="https://www.sigmameow.com/blog/files/13/python.stl" download="python.stl">python.stl</a>文件
<img class="img-fluid" src="img/13/530951687.png"/></p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="kn">import</span> <span class="n">tvtk</span>
<span class="kn">from</span> <span class="nn">tvtkfunc</span> <span class="kn">import</span> <span class="n">ivtk_scene</span><span class="p">,</span><span class="n">event_loop</span>
 
<span class="n">s</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">STLReader</span><span class="p">(</span><span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;python.stl&quot;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">PolyDataMapper</span><span class="p">(</span><span class="n">input_connection</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">output_port</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">Actor</span><span class="p">(</span><span class="n">mapper</span> <span class="o">=</span> <span class="n">m</span><span class="p">)</span>
 
<span class="n">win</span> <span class="o">=</span> <span class="n">ivtk_scene</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">win</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">isometric_view</span><span class="p">()</span>
<span class="n">event_loop</span><span class="p">()</span>
</pre></div>


<p><img class="img-fluid" src="img/13/6d02c55c-91e7-4617-8e8d-ff3fdbc04211.png"/></p>
<h1 class="section-heading h5" id="232-plot3dnasa">2.3.2 Plot3D(NASA)</h5>
<ul>
<li>
<p>网格文件(XYZ文件) <a href="https://www.sigmameow.com/blog/files/13/combxyz.bin" download="combxyz.bin">combxyz.bin</a></p>
</li>
<li>
<p>空气动力学结果文件(Q文件) <a href="https://www.sigmameow.com/blog/files/13/combq.bin" download="combq.bin">combq.bin</a></p>
</li>
<li>
<p>通用结果</p>
</li>
</ul>
<div class="codehilite"><pre><span></span><span class="n">plot3d</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">MultiBlockPLOT3DReader</span><span class="p">(</span>
        <span class="n">xyz_file_name</span><span class="o">=</span><span class="s2">&quot;combxyz.bin&quot;</span><span class="p">,</span>   <span class="c1"># 网格文件</span>
        <span class="n">q_file_name</span><span class="o">=</span><span class="s2">&quot;combq.bin&quot;</span><span class="p">,</span>   <span class="c1"># 空气动力学结果文件</span>
        <span class="n">scalar_function_number</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>   <span class="c1"># 设置标量数据数量</span>
        <span class="n">vector_function_number</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>   <span class="c1"># 设置矢量数据数量</span>
<span class="n">plot3d</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>    <span class="c1"># 让Plot3D计算其输出数据</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">plot3d</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">get_block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="c1"># 获取读入的数据集对象</span>
</pre></div>


<h1 class="section-heading h3" id="24">2.4 数据可视化</h3>
<p><img class="img-fluid" src="img/13/146405156.png"/></p>
<h1 class="section-heading h5" id="241">2.4.1 标量可视化</h5>
<p><a href="https://www.sigmameow.com/blog/files/13/plot3d_contours.py" download="plot3d_contours.py">plot3d_contours.py</a></p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="kn">import</span> <span class="n">tvtk</span>
<span class="kn">from</span> <span class="nn">tvtkfunc</span> <span class="kn">import</span> <span class="n">ivtk_scene</span><span class="p">,</span> <span class="n">event_loop</span>

<span class="c1"># 读取Plot3D数据</span>
<span class="n">plot3d</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">MultiBlockPLOT3DReader</span><span class="p">(</span>
<span class="o">...</span><span class="p">(</span><span class="err">见</span><span class="mf">2.3</span><span class="o">.</span><span class="mi">2</span><span class="err">，</span> <span class="err">从略</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">plot3d</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">get_block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  

<span class="c1"># 创建等值面</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">ContourFilter</span><span class="p">()</span>   <span class="c1"># 创建等值面对象</span>
<span class="n">con</span><span class="o">.</span><span class="n">set_input_data</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
<span class="n">con</span><span class="o">.</span><span class="n">generate_values</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">point_data</span><span class="o">.</span><span class="n">scalars</span><span class="o">.</span><span class="n">range</span><span class="p">)</span>   <span class="c1"># 指定轮廓数和数据范围</span>

<span class="c1"># 绘制数据</span>
<span class="c1">## 设定映射器的变量范围属性</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">PolyDataMapper</span><span class="p">(</span><span class="n">scalar_range</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">point_data</span><span class="o">.</span><span class="n">scalars</span><span class="o">.</span><span class="n">range</span><span class="p">,</span> <span class="n">input_connection</span><span class="o">=</span><span class="n">con</span><span class="o">.</span><span class="n">output_port</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">Actor</span><span class="p">(</span><span class="n">mapper</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.5</span>   <span class="c1"># 设定透明度为0.5</span>

<span class="c1"># 窗口绘制</span>
<span class="n">win</span> <span class="o">=</span> <span class="n">ivtk_scene</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">win</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">isometric_view</span><span class="p">()</span>
<span class="n">event_loop</span><span class="p">()</span>
</pre></div>


<p><img class="img-fluid" src="img/13/contour.gif"/></p>
<p>这里用到了一个工具： tvtk.CountourFilter() 等值面过滤器</p>
<div class="table-responsive"><table class="table table-striped table-bordered" align="center">
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>generate_values()</td>
<td>设定n条等值线的值，一般用于重新绘制等值线</td>
</tr>
<tr>
<td>set_value()</td>
<td>设定一条等值线的值，一般用于覆盖某条等值线或者新增加一条等值线</td>
</tr>
</tbody>
</table></div>
<p>generate_values参数调节的效果：
<img class="img-fluid" src="img/13/146212140.png"/>
set_value()参数调节效果
<img class="img-fluid" src="img/13/146344328.png"/></p>
<h1 class="section-heading h5" id="242">2.4.2 矢量可视化</h5>
<p>主要用到两个工具：tvtk.Glyph3D()符号化技术 和 tvtk.MaskPoints()降采样</p>
<p><a href="https://www.sigmameow.com/blog/files/13/plot3d_arrow.py" download="plot3d_arrow.py">plot3d_arrow.py</a></p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="kn">import</span> <span class="n">tvtk</span>
<span class="kn">from</span> <span class="nn">tvtkfunc</span> <span class="kn">import</span> <span class="n">ivtk_scene</span><span class="p">,</span> <span class="n">event_loop</span>

<span class="c1"># 读取Plot3D数据</span>
<span class="n">plot3d</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">MultiBlockPLOT3DReader</span><span class="p">(</span>
<span class="o">...</span><span class="p">(</span><span class="err">略</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">plot3d</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">get_block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="c1"># 获取读入的数据集对象</span>

<span class="c1"># 数据随机选取</span>
<span class="c1">## 对数据集中的数据进行随机选取，每50个点选择一个点</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">MaskPoints</span><span class="p">(</span><span class="n">random_mode</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">on_ratio</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">mask</span><span class="o">.</span><span class="n">set_input_data</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
<span class="c1">## 创建表示箭头的PolyData数据集</span>
<span class="n">glyph_source</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">ArrowSource</span><span class="p">()</span>

<span class="c1"># 绘制箭头</span>
<span class="c1">## 在Mask采样后的PolyData数据集每个点上放置一个箭头</span>
<span class="c1">## 箭头的方向、长度和颜色由与点对应的矢量和标量数据决定</span>
<span class="n">glyph</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">Glyph3D</span><span class="p">(</span><span class="n">input_connection</span><span class="o">=</span><span class="n">mask</span><span class="o">.</span><span class="n">output_port</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">glyph</span><span class="o">.</span><span class="n">set_source_connection</span><span class="p">(</span><span class="n">glyph_source</span><span class="o">.</span><span class="n">output_port</span><span class="p">)</span>
<span class="c1">## 绘制数据</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">PolyDataMapper</span><span class="p">(</span><span class="n">scalar_range</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">point_data</span><span class="o">.</span><span class="n">scalars</span><span class="o">.</span><span class="n">range</span><span class="p">,</span> <span class="n">input_connection</span><span class="o">=</span><span class="n">glyph</span><span class="o">.</span><span class="n">output_port</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">Actor</span><span class="p">(</span><span class="n">mapper</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># 窗口绘制</span>
<span class="n">win</span> <span class="o">=</span> <span class="n">ivtk_scene</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">win</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">isometric_view</span><span class="p">()</span>
<span class="n">event_loop</span><span class="p">()</span>
</pre></div>


<p><img class="img-fluid" src="img/13/arrow.gif"/>
如果把代码中的箭头<code>glyph_source = tvtk.ArrowSource()</code>改成圆锥<code>glyph_source_tvtk.ConeSource()</code>并设置缩放系数<code>tvtk.Glyph3D(..., Scale_factor=2)</code>
会出来这样的效果
<img class="img-fluid" src="img/13/147464140.png"/></p>
<h1 class="section-heading h5" id="243">2.4.3 空间轮廓线可视化</h5>
<p>使用tvtk.StructuredGridOutlineFilter()计算PolyData对象的外边框</p>
<p><a href="https://www.sigmameow.com/blog/files/13/plot3d_outline.py" download="plot3d_outline.py">plot3d_outline.py</a></p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="kn">import</span> <span class="n">tvtk</span>
<span class="kn">from</span> <span class="nn">tvtk.common</span> <span class="kn">import</span> <span class="n">configure_input</span>   <span class="c1"># 注意这里调用了一个新模块</span>
<span class="kn">from</span> <span class="nn">tvtkfunc</span> <span class="kn">import</span> <span class="n">ivtk_scene</span><span class="p">,</span> <span class="n">event_loop</span>

<span class="c1"># 读取Plot3D数据</span>
<span class="n">plot3d</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">MultiBlockPLOT3DReader</span><span class="p">(</span>
<span class="o">...</span><span class="p">(</span><span class="err">略</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">plot3d</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">get_block</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="c1"># 获取读入的数据集对象</span>

<span class="c1"># 计算轮廓线</span>
<span class="n">outline</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">StructuredGridOutlineFilter</span><span class="p">()</span>   <span class="c1"># 计算表示外边框的PolyData对象</span>
<span class="n">configure_input</span><span class="p">(</span><span class="n">outline</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>   <span class="c1"># 调用tvtk.common.configure_input()</span>
<span class="c1"># 绘制</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">PolyDataMapper</span><span class="p">(</span><span class="n">input_connection</span><span class="o">=</span><span class="n">outline</span><span class="o">.</span><span class="n">output_port</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">Actor</span><span class="p">(</span><span class="n">mapper</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span>

<span class="c1"># 窗口绘制</span>
<span class="n">win</span> <span class="o">=</span> <span class="n">ivtk_scene</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">win</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">isometric_view</span><span class="p">()</span>
<span class="n">event_loop</span><span class="p">()</span>
</pre></div>


<p><img class="img-fluid" src="img/13/outline.gif"/></p>